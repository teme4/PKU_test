/******************************************************************************/
/*     	 Name:         esb_my.c                                               */
/*       Author:       Vladimir Pecherskih                                    */
/*       Date:         07.09.2020                                             */
/******************************************************************************/
#include "main.h"
#include "esb_my.h"
#include "spi_soft_my.h"
#include "nrf24l01_my.h"
#include "usbd_cdc_if.h"

//#include "papka/cat.h"

/******************************************************************************/
/*              Constant declarations :                                       */
/******************************************************************************/

/******************************************************************************/
/*              Variable declarations :                                       */
/******************************************************************************/   
uint16_t    time;
uint8_t     time_ok = RESET;

uint8_t     rx_usb_buff[USB_BUF_LEN];
uint8_t     tx_usb_buff[USB_BUF_LEN];
uint8_t     esb_mode = WORK_INIT;
uint8_t     rx_ok    = RESET;
uint8_t     count_rx = 0;

/******************************************************************************/
/*      	    Functions declarations :                                      */
/******************************************************************************/
void  Processing_Usb_Rx(void);
void  GPIO_Init_My(void);
void  Cycle_Esb(void);

/******************************************************************************/
/******************************************************************************/





/******************************************************************************/
/******************************************************************************/
/*                                                                            */
/*  						I N I T                                           */
/*                                                                            */
/******************************************************************************/
/******************************************************************************/
void  GPIO_Init_My(void)
{ 
  // in  main
}
/******************************************************************************/
/******************************************************************************/
/*                                                                            */
/*  					  U S B    R X                                        */
/*                                                                            */
/******************************************************************************/
/******************************************************************************/
void  Processing_Usb_Rx(void)
{
  //
}
/******************************************************************************/
/******************************************************************************/





/******************************************************************************/
/******************************************************************************/
/*                                                                            */
/*  					  C L O C K                                           */
/*                                                                            */
/******************************************************************************/
/******************************************************************************/
void HAL_SYSTICK_Callback(void)
{   
    time++;
    if(time == 100)
    {
        time = 0;           //  100 ms 
               
        Nrf24_TxData();
        Nrf24_RxData();              
    }
}
/******************************************************************************/
/******************************************************************************/





/******************************************************************************/
/******************************************************************************/
/*                                                                            */
/*  				C Y C L E    M Y                                          */
/*                                                                            */
/******************************************************************************/
/******************************************************************************/
void  Cycle_Esb(void)
{
	switch (esb_mode) 			
    {   //---------------------------------------------------------------------
		case WORK_INIT:
		{			
            nrf24L01_Init();
            DataTx_Init();   
            EncodePacket();          
    
            esb_mode = WORK_TX;
			break;				
		}         
        //---------------------------------------------------------------------	
		case WORK_TX:
		{          

               
			break;					
		}
        //---------------------------------------------------------------------	
		default: break;
	}
}
/******************************************************************************/
/******************************************************************************/


